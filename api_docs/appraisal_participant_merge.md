# AppraisalParticipant (Участник анкетирования)
## Создание

`POST /api/appraisals/{appraisalId}/participants`

где ```appraisalId``` - идентификатор анкетирования

Пример сообщения в Body запроса:

```json
{
    "externalId": "externalID1104",
    "participantUserExternalId": "SU44617",
    "dateCompleted": "2018-07-01T00:00:00+03:00",
    "isMain": false,
    "textFeedback": "0KLRg9GCINGA0LDQt9C90YvQtSDQv9C+0LvQtdC30L3Ri9C1INGA0LXQutC+0LzQtdC90LTQsNGG0LjQuCA=",
    "textHint": "0KLRg9GCINGA0LDQt9C90YvQtSDQv9C+0LvQtdC30L3Ri9C1INGA0LXQutC+0LzQtdC90LTQsNGG0LjQuCA=",
    "status": 3,
    "participationReason": "0KLRg9GCINGA0LDQt9C90YvQtSDQv9C+0LvQtdC30L3Ri9C1INGA0LXQutC+0LzQtdC90LTQsNGG0LjQuCA=",
    "requestDate": "2019-01-15T00:00:00+03:00",
    "responseDate": "2018-12-25T00:00:00+03:00"
}
```

### Описание полей

|Поле|Тип|Ограничения|Описание|
|----|--------|------------|------------|
|externalId|string| Unique |Внешний идентификатор (опциональный)|
|participantUserExternalId|string|Not Null |Идентификатор пользователя из внешней системы, участника-опрашиваемого|
|dateCompleted| datetime (подробнее о формате [здесь](general.md))| - |Дата выполнения|
|isMain| boolean  |Not Null | Является ли участник основным опрашиваемым|
|textFeedback| string | - | Текстовый отзыв. Строка, закодированная в Base64. *Максимальная длина - 4000 символов*|
|textHint| string | - | Тестовая подсказка от основного опрашиваемого. Строка, закодированная в Base64. *Максимальная длина - 4000 символов*|
|status| Значения из [перечисления](#appraisalParticipant_status)| Not Null | Статус участника анкетирования|
|participationReason| string | - | Основание участия. Строка, закодированная в Base64. *Максимальная длина - 4000 символов*|
|requestDate| datetime (подробнее о формате [здесь](general.md))|-| Дата отправки |
|requestLastDate| datetime (подробнее о формате [здесь](general.md))|-| Дата получения ответа |

<a name="appraisalParticipant_status"></a>
#### Статус участника анкетирования
|Значение|Описание|
|----|--------|
| 1 | Запрошен | 
| 2 | Предоставлен |
| 3 | Не запрошен |
| 4 | Нет возможности оценить|
| 5 | Удален|

### Логика работы

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```.
В случае создания записи будет возвращен статус ```201 Created```. В теле ответа JSON с идентификатором созданной сущности:

```json
{
    "id": "c8a35627-db25-45e8-a09d-ee7d1c6e8e8c"
}
```

## Обновление

`PUT /api/appraisals/{appraisalId}/participants/{participantId}`

где ```appraisalId``` - идентификатор анкетирования, ```participantId``` - идентификатор участника этого анкетирования

### Логика работы

Сообщение в тело запроса соответствует сообщению для создания сущности. Сущность обновляется целиком (полная замена ресурса), поэтому должным быть заполнены все параметры. Если какой-то из параметров будет отсутствовать в теле запроса, то это будет воспринято как заполнение пустым значением.
</br>

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```. Если анкетирование с переданным идентификатором не будет найдено, то будет передан код ```404 NotFound```.
В случае успешного обновления записи будет возвращен статус ```204 NoContent```.


## Частичное обновление

`PATCH /api/appraisals/{appraisalId}/participants/{participantId}`

где ```appraisalId``` - идентификатор анкетирования, ```participantId``` - идентификатор участника этого анкетирования

Для частичного обновления ресурса используется формат [JSON Patch](http://jsonpatch.com/). Пример Body запроса:

```json
[
    {
        "op": "replace",
        "path": "/dateCompleted",
        "value": "2020-07-10T00:00:00+03:00"
    }
]
```

### Логика работы

Формата JSON Patch позволяет манипулировать отдельными полями сущности (замена, копирование, удаление).
</br>

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```. Если анкетирование с переданным идентификатором не будет найдено, то будет передан код ```404 NotFound```.
В случае успешного обновления записи будет возвращен статус ```204 NoContent```.


## Удаление


`DELETE /api/appraisals/{appraisalId}/participants/{participantId}`

где ```appraisalId``` - идентификатор анкетирования, ```participantId``` - идентификатор участника этого анкетирования


### Логика работы

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```. Если анкетирование с переданным идентификатором не будет найдено, то будет передан код ```404 NotFound```.
В случае успешного удаления записи будет возвращен статус ```204 NoContent```.


## Получение 

#### Получение конкретной записи
`GET /api/appraisals/{appraisalId}/participants/{participantId}`

где ```appraisalId``` - идентификатор анкетирования, ```participantId``` - идентификатор участника этого анкетирования
 
#### Получение всех записей (участники конкретного анкетирования)

`GET /api/appraisals/{appraisalId}/participants`

где ```appraisalId``` - идентификатор анкетирования

### Логика работы

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```. Если анкетирование с переданным идентификатором не будет найдено (либо участник анкетирования), то будет передан код ```404 NotFound```.
В случае успешного запроса возвращен статус ```200 OK```, в теле же запроса будет сообщение с данными. Пример:

```json
{
    "id": "673951c8-8a49-46b2-88e3-72f3f2ade324",
    "externalId": "1507",
    "dateCompleted": "2017-07-01T00:00:00+03:00",
    "participantUserId": "2450bf3a-a98c-47a5-b2cf-0184e89d48ba",
    "participantUserExternalId": "SU86353",
    "isMain": true,
    "textFeedback": "0JAg0LfQtNC10YHRjCDQsdGD0LTQtdGCINC30LDRiNC40YTRgNC+0LLQsNC90L3Ri9C5INC+0YLQt9GL0LIhIQ==",
    "textHint": "0JrQsNC60LDRjy3RgtC+INC/0L7QtNGB0LrQsNC30LrQsA==",
    "status": 1,
    "participationReason": null,
    "requestDate": "2017-07-01T00:00:00+03:00",
    "responseDate": "2017-07-01T00:00:00+03:00"
}
```

### Описание полей

|Поле|Тип|Ограничения|Описание|
|----|--------|------------|------------|
|id|string| Unique |Идентификатор участника анкетирования|
|externalId|string| Unique |Внешний идентификатор (опциональный)|
|participantUserId|string|Not Null |Внутренний идентификатор пользователя, участника-опрашиваемого|
|participantUserExternalId|string|Not Null |Идентификатор пользователя из внешней системы, участника-опрашиваемого|
|dateCompleted| datetime (подробнее о формате [здесь](general.md))| - |Дата выполнения|
|isMain| boolean  |Not Null | Является ли участник основным опрашиваемым|
|textFeedback| string | - | Текстовый отзыв. Строка, закодированная в Base64. *Максимальная длина - 4000 символов*|
|textHint| string | - | Тестовая подсказка от основного опрашиваемого. Строка, закодированная в Base64. *Максимальная длина - 4000 символов*|
|status| Значения из [перечисления](#appraisalParticipant_status)| Not Null | Статус участника анкетирования|
|participationReason| string | - | Основание участия. Строка, закодированная в Base64|
|requestDate| datetime (подробнее о формате [здесь](general.md))|-| Дата отправки |
|requestLastDate| datetime (подробнее о формате [здесь](general.md))|-| Дата получения ответа |


В случае получения всех записей возвращается массив элементов с вышеописанным форматом.
